{"version":3,"sources":["../../src/controller/server.js"],"names":["aws","require","express","multer","multerS3","config","db","api","spacesEndpoint","Endpoint","s3","S3","endpoint","accessKeyId","secretAccessKey","upload","storage","acl","contentType","AUTO_CONTENT_TYPE","bucket","metadata","req","file","cb","fieldName","fieldname","key","Date","now","toString","single","post","request","response","error","console","log","location","json","fileUrl","message"],"mappings":";;;;;;AAAA;;;;AACA;;AACA;;;;;;AACA,IAAIA,MAAMC,QAAQ,SAAR,CAAV;AACA,IAAIC,UAAUD,QAAQ,SAAR,CAAd;AACA,IAAIE,SAASF,QAAQ,QAAR,CAAb;AACA,IAAIG,WAAWH,QAAQ,WAAR,CAAf;;kBAGe,gBAAkB;AAAA,MAAhBI,MAAgB,QAAhBA,MAAgB;AAAA,MAARC,EAAQ,QAARA,EAAQ;;AAC/B,MAAIC,MAAM,sBAAV;AACA,MAAMC,iBAAiB,IAAIR,IAAIS,QAAR,CAAiB,6BAAjB,CAAvB;AACA,MAAMC,KAAK,IAAIV,IAAIW,EAAR,CAAW;AACpBC,cAAUJ,cADU;AAEpBK,iBAAa,sBAFO;AAGpBC,qBAAiB;AAHG,GAAX,CAAX;;AAMA,MAAIC,SAASZ,OAAO;AAClBa,aAASZ,SAAS;AAChBM,UAAIA,EADY;AAEhBO,WAAK,aAFW;AAGhBC,mBAAad,SAASe,iBAHN;AAIhBC,cAAQ,cAJQ;AAKhBC,gBAAU,kBAAUC,GAAV,EAAeC,IAAf,EAAqBC,EAArB,EAAyB;AACjCA,WAAG,IAAH,EAAS,EAACC,WAAWF,KAAKG,SAAjB,EAAT;AACD,OAPe;AAQhBC,WAAK,aAAUL,GAAV,EAAeC,IAAf,EAAqBC,EAArB,EAAyB;AAC5BA,WAAG,IAAH,EAASI,KAAKC,GAAL,GAAWC,QAAX,EAAT;AACD;AAVe,KAAT;AADS,GAAP,EAaVC,MAbU,CAaH,MAbG,CAAb;;AAgBAxB,MAAIyB,IAAJ,CAAS,SAAT,EAAoB,UAACC,OAAD,EAAUC,QAAV,EAAuB;AACzCnB,WAAOkB,OAAP,EAAgBC,QAAhB,EAA0B,UAAUC,KAAV,EAAiB;AACzC,UAAIA,KAAJ,EAAW;AACTC,gBAAQC,GAAR,CAAYF,KAAZ;AACD;;AAEDC,cAAQC,GAAR,CAAY,SAAOJ,QAAQV,IAAR,CAAae,QAAhC;AACAJ,eAASK,IAAT,CAAc;AACZC,iBAASP,QAAQV,IAAR,CAAae,QADV;AAEZG,iBAAS,6BAFG,EAAd;AAGC,KATH;AAUC,GAXH;AAYE,SAAOlC,GAAP;AACD,C","file":"server.js","sourcesContent":["import mongoose  from \"mongoose\";\nimport { Router } from \"express\";\nimport bodyPaser from \"body-parser\";\nvar aws = require('aws-sdk');\nvar express = require('express');\nvar multer = require('multer');\nvar multerS3 = require('multer-s3');\n\n\nexport default ({config, db}) => {\n  let api = Router();\n  const spacesEndpoint = new aws.Endpoint('nyc3.digitaloceanspaces.com');\n  const s3 = new aws.S3({\n    endpoint: spacesEndpoint,\n    accessKeyId: '5ROOGB5NZBTM6CVLF6TZ',\n    secretAccessKey: 'L+gqMlcp0DGa0uKeBvh5FxPoagkRmDrc+4RjVEl6aEs'\n  });\n\n  var upload = multer({\n    storage: multerS3({\n      s3: s3,\n      acl: 'public-read',\n      contentType: multerS3.AUTO_CONTENT_TYPE,\n      bucket: 'ruka-storage',\n      metadata: function (req, file, cb) {\n        cb(null, {fieldName: file.fieldname});\n      },\n      key: function (req, file, cb) {\n        cb(null, Date.now().toString())\n      }\n    })\n  }).single('file');\n\n\n  api.post('/upload', (request, response) => {\n    upload(request, response, function (error) {\n      if (error) {\n        console.log(error);\n      }\n\n      console.log(\"file\"+request.file.location);\n      response.json({\n        fileUrl: request.file.location,\n        message: 'File uploaded successfully.'});\n      })\n    });\n    return api;\n  }\n"]}